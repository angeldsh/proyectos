<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Registro</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-button class="custom-button uppercase text-center text-base" expand="full" (click)="abrirSelectorFecha()">
    {{ (fechaInicio || fechaFin) ? (fechaInicio | date: 'dd/MM/yyyy') : 'Selecciona fechas' }} {{ fechaFin ? '- ' + (fechaFin | date: 'dd/MM/yyyy') : '' }}
  </ion-button>

  <ion-popover [isOpen]="mostrarSelectorFecha" (ionPopoverDidDismiss)="cerrarSelectorFecha()">
    <ng-template>
      <ion-datetime display-format="DD/MM/YYYY" [(ngModel)]="fechaInicio" (ionChange)="validarFechas()"></ion-datetime>
      <ion-datetime display-format="DD/MM/YYYY" [(ngModel)]="fechaFin" (ionChange)="validarFechas()"></ion-datetime>
      <div class="button-container">
        <ion-button expand="block" color="danger" (click)="resetearFecha()" class="button-item">Limpiar</ion-button>
        <ion-button expand="block" (click)="cerrarSelectorFecha()" class="button-item">Filtrar</ion-button>
      </div>
    </ng-template>
  </ion-popover>
  
  
  <ng-container *ngFor="let ticketCodigoAcceso of getKeys(pedidosFiltradosPorFecha)">
    <ion-card>
      <ion-card-header class="custom-color">
        <ion-card-title *ngIf="ticketCodigoAcceso !== 'A domicilio'" class="font-bold uppercase text-center">
          Ticket: {{ ticketCodigoAcceso }}
        </ion-card-title>
        <ion-card-title *ngIf="ticketCodigoAcceso == 'A domicilio'" class="font-bold uppercase text-center">
          Pedidos a domicilio
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ng-container *ngFor="let pedido of pedidosFiltradosPorFecha[ticketCodigoAcceso]">
          <ion-card class="pedido-card">
            <ion-card-header>
              <ion-card-subtitle class="text-white">
                Tipo de pedido: {{ pedido.tipo }}
              </ion-card-subtitle>
              <ion-card-title>
                Hora de pedido: {{ pedido.fecha | date: 'HH:mm' }}, día
                {{ pedido.fecha | date: 'dd/MM' }}
                <ion-spinner *ngIf="pedido.estado !== 'completado' && pedido.estado !== 'pendiente'" name="dots" color="light" size="large"></ion-spinner>
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item *ngIf="pedido.direccion && pedido.direccion.direccion">
                <ion-label>
                  Dirección de envío: {{ pedido.direccion.direccion }}
                </ion-label>
              </ion-item>
              <ion-item *ngIf="pedido.ticket && pedido.ticket.mesa">
                <ion-label> Mesa: {{ pedido.ticket.mesa.numero }} </ion-label>
              </ion-item>
              <ion-list *ngIf="pedido.id !== null && detallesPedidos[pedido.id]">
                <ion-item *ngFor="let detalle of detallesPedidos[pedido.id]">
                  <ion-label>
                    {{ detalle.producto.nombre }} &nbsp;&nbsp;x &nbsp;
                    {{ detalle.cantidad }} ud &nbsp;-&nbsp;&nbsp;
                    {{ detalle.precio * detalle.cantidad }} €
                  </ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ng-container>
      </ion-card-content>
    </ion-card>
  </ng-container>
</ion-content>
